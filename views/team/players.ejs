<div class="container">
  <h1>Players</h1>
  <div class="pb-2 w-25">
    <input class="form-control" id="myInput" type="text" placeholder="Search..">
  </div>
  
  <div class="row">
    <!-- Filters -->
    <div class="col">
      <div class="pb-3">
        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#orderBy">
          Order by
        </button>
      </div>
      <div id="orderBy" class="collapse show pb-3">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="myOrder" id="alphaAZ" value="option1">
          <label class="form-check-label" for="myOrder">
            Player name (A-Z)
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="myOrder" id="alphaZA" value="option2">
          <label class="form-check-label" for="myOrder">
            Player name (Z-A)
          </label>
        </div>
      </div>
      <div class="pb-3">
        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#skillLevel">
          Skill Level (not available yet)
        </button>
      </div>
      <div id="skillLevel" class="collapse show pb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="option1" id="beginner">
          <label class="form-check-label" for="defaultCheck1">
            Beginner
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="option2" id="intermediate">
          <label class="form-check-label" for="defaultCheck2">
            Intermediate
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="option2" id="advanced">
          <label class="form-check-label" for="defaultCheck3">
            Advanced
          </label>
        </div>
      </div>
    </div>

    <!-- Actual Data -->
    <div class="col-10">
      <div class="row row-cols-1 row-cols-md-3" id="myPlayers">
        <% players.forEach( item => { %>
          <div class="col mb-4 playerList">
            <div class="card">
                <img
                src="<%= item.picture %>"
                class="card-img-top"
                alt="player profile"
                width="380"
                height="200"
                />
                <div class="card-body">
                  <h5 class="card-title"><%= item.fname %> <%= item.lname %></h5>
                  <div class="card-text">
                      <p>Sport: <%= item.sport %> <br />Skill: <%= item.skill %></p>
                  </div>
                  <a class="btn btn-primary" href= <%= "/players/" + item.id %>>Click here for more info</a>
                </div>
            </div>
          </div>
        <%})%>
      </div>
    </div>

  </div>
</div>

<!-- Event Listeners -->
<script>
  // Search Function
  $(document).ready(function(){
    $("#myInput").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#myPlayers .playerList").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });

    // Order by alphabet
    $("#alphaAZ").on("click", function() {
      var mylist = $('#myPlayers');
      var listitems = mylist.children('.playerList').get();
      listitems.sort(function(a, b) {
        return $(a).children('div').children('div').children('.card-title').text().toUpperCase().localeCompare($(b).children('div').children('div').children('.card-title').text().toUpperCase());
        // return $(a).text().toUpperCase().localeCompare($(b).text().toUpperCase());
      })
      $.each(listitems, function(idx, itm) {
        for (let i = itm.classList.length - 1; i >= 0; i--) {
          const className = itm.classList[i];
          if (className.startsWith('order')) {
            itm.classList.remove(className);
          }
        }
        $(itm).addClass(`order-${(idx+1)}`)
      });
    });

    $("#alphaZA").on("click", function() {
      var mylist = $('#myPlayers');
      var listitems = mylist.children('.playerList').get();
      listitems.sort(function(a, b) {
        return $(a).children('div').children('div').children('.card-title').text().toUpperCase().localeCompare($(b).children('div').children('div').children('.card-title').text().toUpperCase());
      })
      $.each(listitems, function(idx, itm) {
        for (let i = itm.classList.length - 1; i >= 0; i--) {
          const className = itm.classList[i];
          if (className.startsWith('order')) {
            itm.classList.remove(className);
          }
        }
        $(itm).addClass(`order-${(listitems.length - idx)}`)
      });
    });
    
  });
</script>
